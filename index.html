<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Budgetter</title>
	<link rel="stylesheet/less" href="css/main.less" />
	<script src="js/less-1.0.33.min.js" type="text/javascript"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<!--
	<script src="fancybox/jquery.fancybox-1.3.1.js"></script>
	<link href="fancybox/jquery.fancybox-1.3.1.css" rel="stylesheet" />
-->
	<script src="js/core.js"></script>
	<script src="js/budget.js"></script>
	<script src="js/menu.js"></script>
	<script type="text/javascript" charset="utf-8">
	    less.env = "development";
	    less.watch();
	    less.poll = 250;
	    jQuery.event.props.push("dataTransfer");
	    	    
	    jQuery( function ($) {
	    	var Menu = _budgetter.getModule('menu'),
	    		Budget = _budgetter.getModule('budget');

	    	Menu.setContainer( $('#menuContainer') );
	    	
	   		var fileGroup = Menu.addMenuGroup('budget');
			fileGroup.addMenuItem('new', {
				text: 'New budget',
				modal: true,
				box: 'newBudget'
			});
			
			fileGroup.addMenuItem('load', {
				text: 'Load budget',
				modal: true,
				box: 'budgets'
			});
			
			var dbGroup = Menu.addMenuGroup('db');
			dbGroup.addMenuItem('export', {
				modal: true,
				box: 'db',
				text: 'Export budget'
			});
			dbGroup.addMenuItem('import').text('Import budget');
			
			var shareGroup = Menu.addMenuGroup('share');
			shareGroup.addMenuItem('print').text('Print budget');
			shareGroup.addMenuItem('share').text('Share budget');
			
			
			$( Menu.getContainer ).delegate('button[data-item-modal="true"]', 'click', function () {
				var pointer = $(this).attr('data-modal-window');
				$.fancybox({
					content: $('#' + pointer).clone().show()
				});
			});
			
			$('#newBudget').submit( function (e) {
				e.preventDefault();
				
				var budgetName = $('input[type="text"]', this).val();
				
				Budget.newBudget( budgetName );
			});
			
			
			var colMover = $('#col-mover'),
				budgetCol = $('#col1'),
				mouseKeyDown = false;
			
			$(document).bind('mousemove', function (e) {
				if (mouseKeyDown) {
					e.preventDefault();
					
					var x = e.clientX;
					if (x < 250) {
						return false;
					}
					colMover.css('left', x);
					budgetCol.css('width', x);
				}
			});
			
			colMover.bind('mousedown mouseup', function (e) {
				mouseKeyDown = e.type === 'mousedown' ? true : false;
			});

			$('table').delegate('tr', 'dragstart', function (e) {
				e.dataTransfer.effectAllowed = 'move';
				e.dataTransfer.setData('Text', $(this).children('th').attr('data-id'));
				console.log(e);
			});
			$('tbody').bind('dragover dragenter', function (e) {
				e.preventDefault();
			});
			$('tbody').bind('drop', function (e) {
				console.log(e);
			});
		});
	</script>
</head>
<body>
	<header id="head">
		<h1>Budgetter</h1>
		<menu id="menuContainer"></menu>
	</header>
	<ul id="budgets" style="display:none;"></ul>
	<div id="db" style="display:none;">adsad</div>
	<form id="newBudget" style="display:none;">
		<input type="text" name="budget_name" placeholder="Budget name" />
		<input type="submit" value="Go" />
	</form>
	<div id="main">
		<div id="col-mover"></div>
		<table id="budget">
			<col id="col1" />
			<tbody>
			</tbody>
		</table>
	</div>
	<script src="js/modal.js"></script>
</body>
</html>